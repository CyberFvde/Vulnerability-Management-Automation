import requests
import json

# Enter the Nessus server details
nessus_url = 'https://example.com:8834'
nessus_user = 'your_username'
nessus_password = 'your_password'

# Enter the JIRA server details
jira_url = 'https://example.atlassian.net'
jira_user = 'your_username'
jira_password = 'your_password'
jira_project = 'YOUR_PROJECT_KEY'

# Enter the ticket details
ticket_type = 'Bug'
ticket_priority = 'High'
ticket_assignee = 'assignee_username'
ticket_reporter = 'reporter_username'

# Connect to the Nessus API and retrieve the vulnerability data
headers = {'Content-type': 'application/json'}
r = requests.post(nessus_url + '/session', data=json.dumps({'username': nessus_user, 'password': nessus_password}), headers=headers, verify=False)
token = r.json()['token']
headers['X-Cookie'] = 'token=' + token
vulnerabilities = requests.get(nessus_url + '/scans/{SCAN_ID}/vulnerabilities?limit=5000', headers=headers, verify=False).json()

# Create a JIRA ticket for each vulnerability
for vulnerability in vulnerabilities:
    title = vulnerability['plugin_name']
    description = vulnerability['plugin_output']
    severity = vulnerability['severity']
    if severity >= 5:
        data = {
            'fields': {
                'project': {'key': jira_project},
                'summary': title,
                'description': description,
                'issuetype': {'name': ticket_type},
                'priority': {'name': ticket_priority},
                'assignee': {'name': ticket_assignee},
                'reporter': {'name': ticket_reporter}
            }
        }
        r = requests.post(jira_url + '/rest/api/2/issue/', data=json.dumps(data), auth=(jira_user, jira_password), headers=headers, verify=False)
